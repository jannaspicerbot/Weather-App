#!/bin/bash
# Pre-commit hook to prevent committing sensitive files
# This hook prevents accidentally committing .env files containing API credentials

# Color codes for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if .env file is being committed
if git diff --cached --name-only | grep -q "^\.env$"; then
  echo ""
  echo -e "${RED}❌ ERROR: Attempting to commit .env file!${NC}"
  echo ""
  echo "The .env file contains sensitive API credentials and should NEVER be committed."
  echo ""
  echo -e "${YELLOW}What to do:${NC}"
  echo "  1. Remove .env from staging: git reset HEAD .env"
  echo "  2. Verify .env is in .gitignore (it should be)"
  echo "  3. Use .env.example for documenting required variables"
  echo ""
  echo "If you need to commit environment variable documentation:"
  echo "  - Update .env.example instead"
  echo "  - Use placeholder values like 'your_api_key_here'"
  echo ""
  exit 1
fi

# Check for other common secret files
SECRET_FILES=("secrets.py" "config.py" "credentials.json" "*.pem" "*.key")

for pattern in "${SECRET_FILES[@]}"; do
  if git diff --cached --name-only | grep -qE "$pattern"; then
    echo ""
    echo -e "${YELLOW}⚠️  WARNING: Potentially committing sensitive file matching pattern: $pattern${NC}"
    echo ""
    echo "Please verify this file doesn't contain secrets before committing."
    echo "Press Ctrl+C to cancel, or Enter to continue anyway..."
    read -r
  fi
done

# All checks passed
exit 0
